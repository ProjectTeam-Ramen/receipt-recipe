# システムアーキテクチャ

## システム構成図

```
┌─────────────────────────────────────────────────────────────┐
│                         Host Machine                         │
│  ┌───────────────────────────────────────────────────────┐  │
│  │              Docker Container (api)                    │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │          Application Layer                       │  │  │
│  │  │  - FastAPI (REST API)                           │  │  │
│  │  │  - Pydantic (Validation)                        │  │  │
│  │  │  - JWT Authentication                           │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │          Business Logic Layer                    │  │  │
│  │  │  - OCR Processing (Tesseract)                   │  │  │
│  │  │  - Image Processing (OpenCV)                    │  │  │
│  │  │  - NLP (MeCab, Transformers)                   │  │  │
│  │  │  - Recipe Generation (AI Model)                 │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │          Data Access Layer                       │  │  │
│  │  │  - SQLAlchemy ORM                               │  │  │
│  │  │  - Alembic Migration                            │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  │                         │                              │  │
│  └─────────────────────────┼──────────────────────────────┘  │
│                            │                                 │
│  ┌─────────────────────────▼──────────────────────────────┐  │
│  │              Docker Container (db)                      │  │
│  │  ┌─────────────────────────────────────────────────┐   │  │
│  │  │          MySQL 8.0                               │   │  │
│  │  │  - Users                                        │   │  │
│  │  │  - Receipts                                     │   │  │
│  │  │  - Recipes                                      │   │  │
│  │  │  - Ingredients                                  │   │  │
│  │  └─────────────────────────────────────────────────┘   │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                    NVIDIA GPU                            │  │
│  │  - PyTorch Deep Learning                                │  │
│  │  - CUDA 11.7 Acceleration                              │  │
│  └─────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## データフロー

### レシート解析 → レシピ生成フロー

```
1. ユーザー → レシート画像アップロード
        ↓
2. Image Preprocessing (OpenCV)
   - リサイズ
   - ノイズ除去
   - 二値化
        ↓
3. OCR Processing (Tesseract)
   - テキスト抽出
   - 座標情報取得
        ↓
4. Text Processing (MeCab + Transformers)
   - 形態素解析
   - 食材名抽出
   - 数量・単位抽出
        ↓
5. Recipe Generation (AI Model)
   - 食材ベクトル化
   - グラフニューラルネットワーク
   - レシピ生成
        ↓
6. Database Storage (MySQL)
   - レシート情報保存
   - レシピ情報保存
        ↓
7. Response → ユーザー
```

---

**最終更新日**: 2025年10月16日